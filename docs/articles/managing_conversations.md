## مدیریت گفتگو با کاربران

اگر تا حالا پیش اومده که بخواید با کاربرهای باتتون یک گفتگو داشته باشید اما هیچ راه ساده ای برای این کار به ذهنتون نرسیید این مقاله برای شماست\
\
برای مثال فرض کنید به کاربر گفتید اسمت چیه؟\
و حالا منتظر پاسخ از کاربر هستید\
اما اگر پیام داد چطوری بفهمیم که این پاسخ برای همون سؤال قبلی ما بوده؟\
\
بلتون برای این مورد یک سیستم آماده کرده به اسم ماشین استیت\
توی ادامه راه های استفاده از این سیستم از آسون به سخت توضیح داده میشن\
یک نمونه استفاده ازش رو هم میتونید در نمونه [بات گفتگو](./../examples/conversation) مشاهده کنید

### استفاده از ماشین استیت گلوبال

فرض کنید یک کاربر یک پیامی به بات ما داد و اون پیامش در متغیر message دخیره شده\
الان به کاربر میگیم اسمت چیه؟

```python
await message.reply("What is your name?")
```

\
و حالا باید برای کاربر یک وضعیتی بذاریم تا وقتی که دوباره پیام داد بتونیم بفهمیم این پیامش جواب به سؤال اسمت چیه بوده\
مثلا وضعیت کاربر رو روی NAME تنظیم میکنیم

```python
message.author.set_state("NAME")
```

\
حالا برای اینکه اگر کاربر پیام داد بفهمیم روی چه وضعیتی هست میتونیم از این کد استفاده کنیم

```python
message.user.get_state()
```

این کد وضعیتی که کاربر توشه رو به ما میده\
\
اگر وضعیتش NAME باشه یعنی این پیامش جواب به سؤال اسمت چیه هست\
حالا مثلا میخوایم اگر وضعیتش برابر با NAME بود بگیم چه اسم قشنگی

```python
if message.user.get_state() == "NAME":
    await message.reply("What a beautiful name!")
```

\
اما یک راه قشنگ‌تر برای این کار اینه که از کاندیشن at_state استفاده کنیم\
به این شکل میتونیم با کمک این کاندیشن یک هندلر بسازیم که فقط اگر وضعیت کاربر NAME باشه اجرا میشه

```python
@bot.on_message(at_state("NAME"))
async def name_state(client, message):
    await message.reply("What a beautiful name!")
```